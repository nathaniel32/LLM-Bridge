<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WS Demo with Vue</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <h1>WebSocket Demo</h1>
        <input type="text" v-model="messageInput" placeholder="Type a message"/>
        <button @click="sendMessage">Send</button>
        <ul>
            <li v-for="(msg, index) in messages" :key="index">{{ msg }}</li>
        </ul>
    </div>

    <script>
        new Vue({
        el: "#app",
        data: {
            ws: null,
            messageInput: "",
            messages: []
        },
        created() {
            this.ws = new WebSocket("ws://localhost:9050/connection/client");

            this.ws.onopen = () => {
                console.log("Connected to server");
            };

            this.ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    const response = data.content?.interaction?.response;
                    if (response) this.messages.push(response);
                } catch (err) {
                    console.error("Invalid message format:", event.data);
                }
            };
        },
        methods: {
            sendMessage() {
                if (this.messageInput.trim() === "") return;

                const message = {
                    action: "create_job",
                    content: { text_input: this.messageInput }
                };
                this.ws.send(JSON.stringify(message));
                this.messageInput = "";
            }
        }
        });
    </script>
</body>
</html>